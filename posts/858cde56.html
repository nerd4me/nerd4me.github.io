

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/gopher-hiking.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="nerd4me">
  <meta name="keywords" content="">
  
    <meta name="description" content="文接上篇 程序员复式记账指南（上），上篇文章的最后，我们安装了 Beancount 基本环境，并通过官方提供示例账本，对其有了一个初步的认识。 一、基础现在可以开始着手写我们的第一个账本了。怎么写？Beancount 作者提供了非常详尽的使用文档 比如老王如果使用 Beancount 记账的话，他的账本将是这样的 1234567891011121314151617181920211970-01-0">
<meta property="og:type" content="article">
<meta property="og:title" content="程序员复式记账指南（下）">
<meta property="og:url" content="https://nerd4me.github.io/posts/858cde56.html">
<meta property="og:site_name" content="Nerd4me&#39;s Blog">
<meta property="og:description" content="文接上篇 程序员复式记账指南（上），上篇文章的最后，我们安装了 Beancount 基本环境，并通过官方提供示例账本，对其有了一个初步的认识。 一、基础现在可以开始着手写我们的第一个账本了。怎么写？Beancount 作者提供了非常详尽的使用文档 比如老王如果使用 Beancount 记账的话，他的账本将是这样的 1234567891011121314151617181920211970-01-0">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://nerd4me.github.io/img/beancount-bookkeeping.png">
<meta property="article:published_time" content="2023-01-17T13:24:12.000Z">
<meta property="article:modified_time" content="2023-01-17T17:28:28.000Z">
<meta property="article:author" content="nerd4me">
<meta property="article:tag" content="Bookkeeping">
<meta property="article:tag" content="Beancount">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://nerd4me.github.io/img/beancount-bookkeeping.png">
  
  
  
  <title>程序员复式记账指南（下） - Nerd4me&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"nerd4me.github.io","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"oMPKEmwbmKnTBea7XlvaskIk-gzGzoHsz","app_key":"ZkjHiEC8yC8zscGJP1YVrvbB","server_url":"https://ompkemwb.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Nerd4me&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="程序员复式记账指南（下）"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-01-17 21:24" pubdate>
          2023年1月17日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          6.1k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          51 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">程序员复式记账指南（下）</h1>
            
            
              <div class="markdown-body">
                
                <p>文接上篇 <a href="https://nerd4me.github.io/posts/7a37cdfc.html">程序员复式记账指南（上）</a>，上篇文章的最后，我们安装了 Beancount 基本环境，并通过官方提供示例账本，对其有了一个初步的认识。</p>
<h2 id="一、基础"><a href="#一、基础" class="headerlink" title="一、基础"></a>一、基础</h2><p>现在可以开始着手写我们的第一个账本了。怎么写？Beancount 作者提供了非常详尽的<a target="_blank" rel="noopener" href="https://beancount.github.io/docs/index.html">使用文档</a></p>
<p>比如老王如果使用 Beancount 记账的话，他的账本将是这样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs beancount">1970-01-01 open Income:Sales CNY<br>1970-01-01 open Assets:Bank:Saving:ICBC CNY<br>1970-01-01 open Assets:Fixed CNY ;固定资产<br>1970-01-01 open Liabilities:CreditCard:ICBC CNY<br>1970-01-01 open Expenses:Food CNY<br><br>2023-01-01 * &quot;xx公司&quot; &quot;购买设备&quot;<br>  Assets:Bank:Saving:ICBC      -1,000.00 CNY<br>  Assets:Fixed                  1,000.00 CNY<br><br>2023-01-01 * &quot;采购食材&quot;<br>  Liabilities:CreditCard:ICBC   -500.00 CNY<br>  Expenses:Food                  500.00 CNY<br><br>2023-01-02 * &quot;煎饼销售收入&quot;<br>  Income:Sales                -1,000.00 CNY<br>  Assets:Bank:Saving:ICBC      1,000.00 CNY<br><br>2023-01-02 * &quot;质量问题食材退货&quot;<br>  Expenses:Food                 -100.00 CNY<br>  Liabilities:CreditCard:ICBC    100.00 CNY<br></code></pre></td></tr></table></figure>

<p>老王的账本里首先要设立账户。开户日期可随自己的喜好去定义，只需要比最早一笔涉及到该账户的交易早即可，这里偷了个懒，统一使用1970年1月1日作为开启日期，保证之后记录的所有都发生在这个日期之后。</p>
<p>然后就可以真正开始记账了，交易格式如上所示。其中日期后面的星号（*）代表这是一笔已确认的交易，如果换成（!）号的话，则代表这笔交易有疑问，后期对账时应注意。紧跟在对账标识后面的是「收款人」（Payee）和「交易备注」（Narration），需要使用双引号括起来。Payee 是可选的，像上面的示例中只有一串字符串的话，其代表的就是 Narration 了。</p>
<p>老王的账本已经写完了，纯手工书写，肉眼阅读也没啥障碍。那么 Beancount 有什么用？那当然是生成报表啦：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">(BEANCOUNT) bean-report laowang.bean balances<br>Assets:Bank:Saving:ICBC<br>Assets:Fixed                   1000.00 CNY<br>Equity<br>Expenses:Food                   400.00 CNY<br>Income:Sales                  -1000.00 CNY<br>Liabilities:CreditCard:ICBC    -400.00 CNY<br></code></pre></td></tr></table></figure>

<p>通过上面生成的报表，老王对自己的账务状况一目了然：有价值 1,000 元的固定资产，在食材上花了 400 元，一共收入了 1,000 元，信用卡欠款 400 元。bean-report 没有报错，说明账是平的（总和为0）。bean-report 命令还能生成很多报表，具体可以使用 <code>bean-report -h</code> 查看帮助。</p>
<p>当然，还可以用 fava 来启动一个 Web UI 服务，执行 <code>fava laowang.bean</code> 命令，然后在浏览器中打开 <a target="_blank" rel="noopener" href="http://localhost:5000/">http://localhost:5000/</a> 即可。由于老王的数据还比较单薄，这里帖两张样例账本的示例图</p>
<img src="/posts/858cde56/fava_balance_sheet_sample.png" srcset="/img/loading.gif" lazyload class="" title="资产负债表">
<img src="/posts/858cde56/fava_income_statement_sample.png" srcset="/img/loading.gif" lazyload class="" title="损益表">

<h2 id="二、进阶"><a href="#二、进阶" class="headerlink" title="二、进阶"></a>二、进阶</h2><p>这里将另举几个例子，展现下 Beancount 和「复式记账法」能处理多么复杂的交易。这些复杂的交易用单式记账法来记录是极其困难且容易出错的，但是在复式记账中却是如此的自然且流畅。在上一篇里说过，复式记账的「复」是指一笔交易会涉及到复数个账户。上面老王的例子都是两个账户间「一对一」交易。但实际上，生活中会遇到各种「一对多」或「多对多」的交易场景：购买大件物品时因银行支付限额而使用多张银行卡合并付款；和朋友出去聚餐，事后 AA 平摊等。以下几个例子是有意构造的涉及到两个以上账户的交易，让我们一起来看看小王的账本。</p>
<h3 id="2-1-第一个例子"><a href="#2-1-第一个例子" class="headerlink" title="2.1 第一个例子"></a>2.1 第一个例子</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs beancount">2023-01-10 * &quot;Some Company&quot; &quot;💰工资2022-12&quot;<br>  Income:SomeCompany:Salary           -20,000.00 CNY ;应发工资<br>  Income:SomeCompany:Benefits            -500.00 CNY ;节日福利<br>  Income:SomeCompany:HousingFund       -2,000.00 CNY ;住房公积金单位扣除<br>  Assets:Government:HousingFund         4,000.00 CNY ;住房公积金缴纳<br>  Expenses:Government:SocialSecurity    1,500.00 CNY ;社保缴纳<br>  Expenses:Government:IncomeTax         3,000.00 CNY ;个税缴纳<br>  Assets:Bank:Saving:ICBC              14,000.00 CNY ;实发工资<br></code></pre></td></tr></table></figure>

<p>这个例子展现了如何在 Beancount 里体现工资条上的内容。每个月工资条上总是会有各种各样的条目。小王在使用了 Beancount 之后，可以方便地把工资、福利、住房公积金、社保、个税等信息都记录进去，以后能很方便地统计每个月有多少工资是喂狗的。</p>
<p>本例中，Income:* 账户有三条记录，Expenses:* 账户有两条记录，Assets:* 账户有两条记录，共7条记录，总和为0。</p>
<h3 id="2-2-第二个例子"><a href="#2-2-第二个例子" class="headerlink" title="2.2 第二个例子"></a>2.2 第二个例子</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs beancount">2023-01-11 * &quot;XX 购物中心&quot; &quot;购物&quot;<br>  Liabilities:CreditCard:ICBC     -1,000.00 CNY ;信用卡刷卡<br>  Expenses:Entertainment:Game        400.00 CNY ;游戏卡<br>  Assets:Receivables:Xiao-Ming       600.00 CNY ;帮小明付钱，记入应收账户<br></code></pre></td></tr></table></figure>
<p>小王拿到工资的第二天就和小明去购物中心逛游戏店，买了一张新出的游戏卡，花费 400 元，小明没带卡，身上现金不够，于是让小王帮他垫付，小王使用信用卡消费 1,000 元。</p>
<p>本例子中小王的 Liabilities:* 账户减少了 1,000 元，Expenses:* 账户增加 400 元，Assets:* 账户增加 600 元。帮小明付的钱，算是小明欠小王的钱，所以算做资产。所有数字加起来和为0。</p>
<h3 id="2-3-第三个例子"><a href="#2-3-第三个例子" class="headerlink" title="2.3 第三个例子"></a>2.3 第三个例子</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs beancount">2023-01-13 * &quot;xx 饭店&quot; &quot;和小明吃饭&quot;<br>  Assets:Cash:Wallet            -300.00 CNY ;钱包现金<br>  Assets:Receivables:Xiao-Ming  -200.00 CNY ;小明帮我付的现金<br>  Expenses:Food:DiningOut        250.00 CNY ;AA我的一半<br>  Assets:Receivables:Xiao-Ming   250.00 CNY ;AA小明的一半<br></code></pre></td></tr></table></figure>
<p>过了几天小王和小明去一家饭店吃饭。两人一共消费了 500 元，还只能付现金。小王和小明各自掏空了钱包，凑齐了 500 元现金，其中小王付了 300 元，小明付了 200 元。这顿饭两人 AA。</p>
<h3 id="2-4-第四个例子"><a href="#2-4-第四个例子" class="headerlink" title="2.4 第四个例子"></a>2.4 第四个例子</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs beancount">2023-01-17 * &quot;在免税店买东西&quot;<br> Assets:Cash                                 -200.00 USD<br> Liabilities:CreditCard:ICBC                 -650.00 CNY @@ 100.00 USD<br> Expenses:Clothing:Pants                     +150.00 USD<br> Expenses:Clothing:Shoes                     +150.00 USD<br></code></pre></td></tr></table></figure>
<p>小王去国外出差了，回国前为了把兑换的美元现金花掉，忍不住又在免税店大肆购物，结果现金不够，于是 300 美元的商品用现金支付了 200 美元，用信用卡支付了 100 美元。小红的信用卡开通了外币消费人民币入账功能，刷美元也出人民币账单。</p>
<p>本例中，涉及到了合并付款和货币转换。小明的信用卡被扣掉了 650 人民币，这其实是由 100 美元转换而来。在 Beancount 中使用 @@ 即可连接两种互相转换的 commodity。在本次交易中，负数共 -200.00 USD + (-100.00 USD) &#x3D; -300.00 USD，正数共 +150.00 USD + (+150.00 USD) &#x3D; +300.00 USD，正负相加依然得到的是 0。</p>
<h3 id="2-5-使用-bean-query-进行复杂查询"><a href="#2-5-使用-bean-query-进行复杂查询" class="headerlink" title="2.5 使用 bean-query 进行复杂查询"></a>2.5 使用 bean-query 进行复杂查询</h3><p>fava 提供的 Web UI 已经能展现很多有用的财务报表，满足大部分用户的需求，如果用户需要进行一些更复杂的数据统计，比如「我经常去哪里加油」，则可以使用 bean-query 工具用 SQL 语句进行查询，详见 Beancount 作者的文档：<a target="_blank" rel="noopener" href="https://beancount.github.io/docs/beancount_query_language.html">Beancount – Query Language</a>。这是一个用来统计我加油次数的例子：</p>
<img src="/posts/858cde56/bean_query_sample.png" srcset="/img/loading.gif" lazyload class="" title="加油次数">

<h2 id="三、最佳实践"><a href="#三、最佳实践" class="headerlink" title="三、最佳实践"></a>三、最佳实践</h2><p>笔者从2022年9月开始使用 Beancount 来管理个人财务，在使用过程中也总结了一些最佳实践。以下内容说说我个人是怎么使用 Beancount 的，希望对你有所帮助</p>
<h3 id="3-1-编辑器支持"><a href="#3-1-编辑器支持" class="headerlink" title="3.1 编辑器支持"></a>3.1 编辑器支持</h3><p>笔者目前是使用 <code>VSCode</code> 做为账本文件编辑器，加上 <a target="_blank" rel="noopener" href="https://github.com/Lencerf/vscode-beancount">Lencerf&#x2F;vscode-beancount</a> 插件的配合，会自动为 *.bean 或者 *.beancount 文件加上语法高亮以及账户名自动补全，还可以实现金额数据自动对齐，具体配置方法请自己 Google 或者参考 Github 上作者提供的帮助文档。</p>
<h3 id="3-2-账户开户日期的选择"><a href="#3-2-账户开户日期的选择" class="headerlink" title="3.2 账户开户日期的选择"></a>3.2 账户开户日期的选择</h3><p>Beancount 中账户的开户日期必须在该账户第一笔交易之前，小王为了省事将所有账户的开户日期设置为 1970-01-01 这个日期，其实可以有一些更有意义的选择：</p>
<ul>
<li><strong>Expenses</strong> 账户可以使用自己的出生日期作为开户日期；</li>
<li><strong>Income</strong> 账户可以按来源分类，如 <code>Income:SomeCompany:Salary</code>、<code>Income:OtherCompany:Salary</code> 等，然后以入职公司的时间作为开户日期；</li>
<li><strong>Assets</strong> 和 <strong>Liabilities</strong> 账户中的借&#x2F;贷记卡，可以以在银行的开户日期作为 Beancount 账户的开户日期。</li>
</ul>
<p>不要害怕开账户。即使是一些短时间用的小账户（比如只用两个月的储值卡），也可以开账户，因为账户是可以关闭的。关闭后的账户不会出现在关闭后的报表里，所以并不会触发你的强迫症。</p>
<h3 id="3-3-账本文件的分割"><a href="#3-3-账本文件的分割" class="headerlink" title="3.3 账本文件的分割"></a>3.3 账本文件的分割</h3><p>随着时间的积累，账本文件会越来越大，编辑起来不太方便。Beancount 有 include 语句，可以在一个账本文件里包含另一个账本文件。我的主账本文件里只有一些 option 条目，其他都是 include，各种打开&#x2F;关闭账户的的条目放单独的文件里，然后每个月的账本是一个单独的文件，也 include 进来。</p>
<p>Beancount 会把所有交易都读到内存里后按日期重新排序，所以每条交易在文件里出现的顺序并不重要。如下是我的账本文件分割结构，或者可以给你提供参考：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">.<br>├── 2022<br>│   ├── 09.bean<br>│   ├── 10.bean<br>│   ├── 11.bean<br>│   ├── 12.bean<br>│   ├── __index.bean<br>│   ├── creditcard.bean<br>│   ├── event.bean<br>│   ├── forecast.bean<br>│   ├── income.bean<br>│   ├── loan.bean<br>│   └── transfer.bean<br>├── 2023<br>│   ├── 01.bean<br>│   ├── __index.bean<br>│   ├── forecast.bean<br>│   ├── income.bean<br>│   ├── insurance.bean<br>│   ├── loan.bean<br>│   └── transfer.bean<br>├── account<br>│   ├── __index.bean<br>│   ├── assets.bean<br>│   ├── equity.bean<br>│   ├── expenses.bean<br>│   ├── income.bean<br>│   └── liabilities.bean<br>├── commodity<br>│   ├── __index.bean<br>│   └── fund.bean<br>├── doc<br>│   └── __index.bean<br>└── main.bean<br></code></pre></td></tr></table></figure>

<h3 id="3-4-定期断言"><a href="#3-4-定期断言" class="headerlink" title="3.4 定期断言"></a>3.4 定期断言</h3><p>一个维护良好的账本应当定期做断言（assertion），即定期标记某个账户在某个日期的余额（balance），断言的示例如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs beancount">2023-01-01 balance Assets:Cash 500.00 CNY<br>2023-01-01 balance Assets:Cash 100.00 USD<br>2023-01-01 balance Liabilities:CreditCard:CMB1234 1,000.00 CNY<br></code></pre></td></tr></table></figure>

<p>断言语句告诉 Beancount，这个账户在指定日期凌晨 00:00:00 这个时间点，余额为这个数字，上面的示例代表在笔者的账本里，截止2022年12月底，笔者有 500 人民币、100 美元的现金，同时招行尾号 1234 的信用卡里有 1,000 人民币欠款。</p>
<p>添加了断言之后，Beancount 便会检查那个账户的数字是否与断言的数字相等，如果不相等就会报错。人总是会犯错的，当你因为各种原因在账目上出现了错误，断言能帮助你缩小查错范围——你只需要检查最后一次成功的断言之后的发生的交易即可。</p>
<h3 id="3-5-合理填充"><a href="#3-5-合理填充" class="headerlink" title="3.5 合理填充"></a>3.5 合理填充</h3><p>Beancount 另一个有趣的功能是填充（padding），填充是配合断言一起用的，当 Beancount 解析到填充语句时，会自动在这条语句和下一条断言语句之间插入一条填充交易，使得断言成功。在填充语句所在日期和断言语句所在日期之间不能再有其他交易。请看示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs beancount">2022-12-31 pad Assets:Bank:Saving:CMB1234 Income:Trade:PnL<br>2023-01-01 balance Assets:Bank:Saving:CMB1234 12,043.00 CNY<br></code></pre></td></tr></table></figure>

<p>笔者在2022年12月底做账目核对的时候，发现招商银行借记卡里的余额是 12,043 元，但是根据 11 月底的余额，以及 12 月的交易记录，卡里的余额应该没有 12,043 元这么多，仔细看了下，网银里的账单记录，发现之前买的一个活期理财产品每天都有些收益，因此这里使用填充（pad）功能来解决这个问题，在 12 月最后一笔交易和 2023-01-01 的断言之间插入一条 <code>pad</code> 语句，这样 Beancount 会自动插入一条交易，使 <code>Assets:Bank:Saving:CMB1234</code> 里的余额调整为 12,043 元，而因此产生的差额，则记录到 <code>Income:Trade:PnL</code> 账户里。</p>
<p>填充功能比手工写一笔交易有什么好呢？你不需要去计算两个数字之间的差额了—— Beancount 会自动算出差额并帮你插入交易。此外，这个差额是动态计算的。</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Bookkeeping/">#Bookkeeping</a>
      
        <a href="/tags/Beancount/">#Beancount</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>程序员复式记账指南（下）</div>
      <div>https://nerd4me.github.io/posts/858cde56.html</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>nerd4me</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年1月17日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/7a37cdfc.html" title="程序员复式记账指南（上）">
                        <span class="hidden-mobile">程序员复式记账指南（上）</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"oMPKEmwbmKnTBea7XlvaskIk-gzGzoHsz","appKey":"ZkjHiEC8yC8zscGJP1YVrvbB","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  



  <script>
  Fluid.utils.createScript('https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js', function() {
    mermaid.initialize({"theme":"default"});

    Fluid.events.registerRefreshCallback(function() {
      if ('mermaid' in window) {
        mermaid.init();
      }
    });
  });
</script>






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
